<html>
   <head>
      <script src="view.js"></script>
      <script src="simulation.js"></script>
      <style>
         canvas {
            border: solid black 5px;
            margin: 0;
         }
      </style>
   </head>
   <body>
      <canvas width=700 height=700> </canvas>
      <script>
         let canvas = document.querySelector("canvas");
         let ctx = canvas.getContext("2d");
         let simulation = new Simulation(canvas.clientWidth, canvas.clientHeight);

         let particle1 = new Particle(.03, .05e-3, new Vector(0, 300));
         particle1.velocity = new Vector(100, 0);
         let particle3 = new Particle(.003, .1e-3, new Vector(0, -200));
         particle3.velocity = new Vector(700, 0);
         let particle2 = new Particle(.3, 1e-3, new Vector(0, -50));
         simulation.add(particle1);
         simulation.add(particle2);
         simulation.add(particle3);
         simulation.start();

         let layers = new LayerDrawer();
         let drawables = [];
         for(let p of simulation.getParticles()) {
            let drawable = new ParticleDrawable(p);
            drawables.push(drawable);
            
            layers.add(drawable, 2);
            layers.add(drawable.getVelocityDrawable(), 1);
            layers.add(drawable.getForceDrawable(), 1);
         }

         //All camera things
         let camera = new Camera(null, null, layers);
         let dragging = false;
         let lastDrag = null;
         document.addEventListener("mousedown", evt => { 
            dragging = true;
            lastDrag = new Vector(evt.clientX, evt.clientY);
         });
         document.addEventListener("mousemove", evt => {
            if(dragging) {
               let currPos = new Vector(evt.clientX, evt.clientY);
               let drag = currPos.sub(lastDrag);
               lastDrag = currPos;

               camera.translate(drag);
            }
         }); 
         document.addEventListener("mouseup", () => dragging = false);
         document.addEventListener("mousewheel", evt => {
            evt.stopPropagation();
            
            let scaling = evt.wheelDeltaY >= 0 ? 1.05 : 0.95;
            camera.scale(scaling);
         });

         camera.run();
      </script>
   </body>
</html>
